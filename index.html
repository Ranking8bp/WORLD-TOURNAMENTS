<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8" />
    <style>
      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: radial-gradient(circle at top left, #1b2540, #050814);
        color: #f5f7ff;
      }
      .app {
        max-width: 1150px;
        margin: 32px auto;
        padding: 16px 24px 40px;
        background: rgba(5, 10, 25, 0.95);
        border-radius: 18px;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(93, 134, 255, 0.4);
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }
      .title {
        font-size: 26px;
        font-weight: 700;
      }
      .subtitle {
        font-size: 12px;
        opacity: 0.75;
      }
      .perfil-link {
        padding: 8px 14px;
        border-radius: 999px;
        border: 1px solid #ff6b9f;
        font-size: 13px;
        cursor: pointer;
        background: rgba(255, 107, 159, 0.08);
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 16px;
        font-size: 13px;
      }
      thead {
        text-transform: uppercase;
        font-size: 11px;
        letter-spacing: 0.06em;
        color: #b0bddb;
      }
      th, td {
        padding: 10px 8px;
        text-align: left;
      }
      tbody tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.02);
      }
      tbody tr:hover {
        background: rgba(74, 128, 255, 0.12);
      }
      .col-rank {
        width: 40px;
      }
      .avatar {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .avatar-circle {
        width: 28px;
        height: 28px;
        border-radius: 999px;
        overflow: hidden;
        background: linear-gradient(135deg, #334155, #020617);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
      }
      .avatar-circle img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      .flag {
        font-size: 11px;
        padding: 3px 7px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.4);
      }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="header">
        <div>
          <div class="title">RANKING DE COPAS • 8 BALL POOL</div>
          <div class="subtitle">Historial oficial de campeones nocturnos · Torneos diarios</div>
        </div>
        <button class="perfil-link" onclick="abrirPerfil()">
          ✏️ Editar mi perfil
        </button>
      </div>

      <table>
        <thead>
          <tr>
            <th class="col-rank">#</th>
            <th>Jugador</th>
            <th>País</th>
            <th>Copas</th>
            <th>Última copa</th>
            <th>Notas</th>
          </tr>
        </thead>
        <tbody id="ranking-body">
          <tr><td colspan="6">Cargando ranking...</td></tr>
        </tbody>
      </table>
    </div>

    <script>
      function iniciales(nombre) {
        if (!nombre) return "";
        const partes = nombre.trim().split(" ");
        if (partes.length === 1) return partes[0].charAt(0).toUpperCase();
        return (partes[0].charAt(0) + partes[1].charAt(0)).toUpperCase();
      }

      function renderRanking(players) {
        const tbody = document.getElementById("ranking-body");
        tbody.innerHTML = "";

        players.forEach((p, idx) => {
          const tr = document.createElement("tr");

          const tdRank = document.createElement("td");
          tdRank.textContent = idx + 1;
          tr.appendChild(tdRank);

          const tdJugador = document.createElement("td");
          const avatar = document.createElement("div");
          avatar.className = "avatar";

          const circle = document.createElement("div");
          circle.className = "avatar-circle";

          if (p.fotoUrl) {
            const img = document.createElement("img");
            img.src = p.fotoUrl;
            img.alt = p.nombre;
            circle.appendChild(img);
          } else {
            circle.textContent = iniciales(p.nombre);
          }

          const nameSpan = document.createElement("span");
          nameSpan.textContent = p.nombre;

          avatar.appendChild(circle);
          avatar.appendChild(nameSpan);
          tdJugador.appendChild(avatar);
          tr.appendChild(tdJugador);

          const tdPais = document.createElement("td");
          const flag = document.createElement("span");
          flag.className = "flag";
          flag.textContent = p.pais || "-";
          tdPais.appendChild(flag);
          tr.appendChild(tdPais);

          const tdCopas = document.createElement("td");
          tdCopas.textContent = p.copas || 0;
          tr.appendChild(tdCopas);

          const tdUltima = document.createElement("td");
          tdUltima.textContent = p.ultimaCopa || "-";
          tr.appendChild(tdUltima);

          const tdNotas = document.createElement("td");
          tdNotas.textContent = p.notas || "";
          tr.appendChild(tdNotas);

          tbody.appendChild(tr);
        });
      }

      function cargarRanking() {
        google.script.run
          .withSuccessHandler(renderRanking)
          .getRankingData();
      }

      function abrirPerfil() {
        window.location.href = "?page=perfil";
      }

      document.addEventListener("DOMContentLoaded", cargarRanking);
    </script>
  </body>
</html>
